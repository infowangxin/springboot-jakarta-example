<!DOCTYPE html>
<html lang="zh_CN"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" th:href="@{/public/favicon.ico}">
    <title>建设银行商户号路由管理</title>
    <meta name="keyword" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Example Demo All Rights Reserved">
    <link th:href="@{/static/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/static/font-awesome/css/font-awesome.css}" rel="stylesheet">
    <link th:href="@{/static/css/plugins/toastr/toastr.min.css}" rel="stylesheet">
    <link th:href="@{/static/css/plugins/sweetalert/sweetalert.css}" rel="stylesheet">
    <link th:href="@{/static/css/animate.css}" rel="stylesheet">
    <link th:href="@{/static/css/style.css}" rel="stylesheet">
</head>

<body th:attr="data-ctx=${application.ctx}" class="fixed-sidebar">
<div id="wrapper">
    <!----左侧导航开始----->
    <nav class="navbar-default navbar-static-side" role="navigation" id="leftnav">
    </nav>
    <!----左侧导航结束----->
    <!---右侧内容区开始---->
    <div id="page-wrapper" class="gray-bg">
        <!---顶部状态栏 star-->
        <div class="row ">
            <nav class="navbar navbar-fixed-top" role="navigation" id="topnav"></nav>
        </div>
        <!---顶部状态栏 end-->
        <!--------当前位置----->
        <div class="row  border-bottom white-bg page-heading">
            <div class="col-sm-4">
                <h2>切换建设银行商户号</h2>
                <ol class="breadcrumb">
                    <li>
                        <a href="javascript:void(0)">支付设置</a>
                    </li>
                    <li>
                        <a class="active" href="javascript:void(0)">切换建设银行商户号</a>
                    </li>
                </ol>
            </div>
        </div>
        <!-----内容区域---->
        <div class="wrapper wrapper-content animated fadeInRight qr-code-box">
            <div class="row">
                <div class="col-md-12">
                    <div class="ibox-content m-b-sm border-bottom">
                        <div class="row justify-content-center">
                            <!-- 设置页面最大宽度为 6 列 -->
                            <div class="col-md-6">
                                <!-- 标题行：商户号、日累积收款、月累积收款、最后更新时间 -->
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th>商户号</th>
                                            <th>日累积收款</th>
                                            <th>月累积收款</th>
                                            <th>截止日期</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <!-- 循环展示每个商户的数据 -->
                                        <tr th:each="route : ${routeMap}"
                                            class="merchat-code"
                                            th:classappend="${route.value.merchantCode == currentMerchantCode} ? ${route.value.merchantCode} + ' alert alert-success ' : ${route.value.merchantCode}">
                                            <td th:text="${route.value.merchantCode}"></td>
                                            <td th:text="${route.value.dailyTotal}"></td>
                                            <td th:text="${route.value.monthlyTotal}"></td>
                                            <td th:text="${#dates.format(route.value.snapshotDate, 'yyyy/MM/dd')}"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <hr/>
                                <!-- 选择框与切换按钮 -->
                                <div class="row">
                                    <div class="col-sm-4 m-t-xs m-b-none">
                                        <select class="form-control" id="channelBranchId">
                                            <!-- 遍历 routeMap 并根据条件高亮匹配的商户号 -->
                                            <option th:each="route : ${routeMap}"
                                                    th:value="${route.key}"
                                                    th:text="${route.value.merchantCode}"
                                                    th:selected="${route.value.merchantCode == currentMerchantCode}">
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-sm-4 m-t-xs m-b-none">
                                        <button class="btn btn-primary btn-change" id="changeRouteBtn" type="button">
                                            <strong>切换</strong>
                                        </button>
                                    </div>
                                </div>
                                <hr/>
                                <!-- 方案提醒 -->
                                <div class="row">
                                    <div class="col-sm-4 m-t-xs m-b-none">
                                        <div class="alert alert-danger mt-3">
                                            <strong>商户号限额:</strong>
                                            <ul>
                                                <li>单笔限额：5万</li>
                                                <li>日限额：50万</li>
                                                <li>月限额：1000万</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
        <!-----内容结束----->

    </div>
    <!---右侧内容区结束----->
</div>
<!-- 全局 scripts -->

<script th:src="@{/static/js/jquery-2.1.1.js}"></script>
<script th:src="@{/static/js/bootstrap.js}"></script>
<script th:src="@{/static/js/wuling.js}"></script>
<script th:src="@{/static/js/plugins/pace/pace.min.js}"></script>
<script th:src="@{/static/js/plugins/slimscroll/jquery.slimscroll.min.js}"></script>
<script th:src="@{/static/js/plugins/metisMenu/jquery.metisMenu.js}"></script>
<!-- 插件 scripts -->
<script th:src="@{/static/js/plugins/toastr/toastr.min.js}" async></script>
<script th:src="@{/static/js/plugins/sweetalert/sweetalert.min.js}" async></script><!---对话框 alert--->
<script th:src="@{/static/js/plugins/loading/jquery.loading.js}"></script>

<script th:inline="javascript">
    $("#changeRouteBtn").click(function () {

        const channelBranchId = $.trim($("#channelBranchId").val());
        const currentMerchantCode = $.trim($("#channelBranchId option:selected").text());
        const channelBranchIdList = [];  //定义数组
        $("#channelBranchId option").each(function () {  //遍历全部option
            const id = $(this).val();   //获取option值
            if (id !== '') {
                channelBranchIdList.push(id);  //加入到数组中
            }
        });
        $(".qr-code-box").loading('show');
        $.ajax({
            url: _ctx + '/payment/changeCcbPaymentRoute',
            type: "post",
            data: {
                "channelBranchId": channelBranchId,
                "channelBranchIdList": channelBranchIdList
            },
            success: function (response) {
                if (response.code === 200) {
                    $(".merchat-code").removeClass("alert alert-success");
                    $("." + currentMerchantCode).addClass("alert alert-success")
                    $(".qr-code-box").loading('hide');
                    toastr.success(response.message, '操作成功');
                } else {
                    toastr.error('', response.message);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                toastr.error('', errorThrown);
                $(".qr-code-box").loading('hide');
            }
        });
    });
</script>
</body>
</html>
